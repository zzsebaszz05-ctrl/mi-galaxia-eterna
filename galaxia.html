<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Galaxia para ti</title>
  <style>
    html,body{margin:0;height:100%;background:#000;overflow:hidden}
    #galaxy-canvas{position:fixed;inset:0;width:100%;height:100%;display:block;touch-action:none}
    
    /* 1. OCULTAR EL REPRODUCTOR BLANCO DEL NAVEGADOR */
    audio {
      display: none !important;
      visibility: hidden !important;
      height: 0 !important;
      width: 0 !important;
      position: absolute;
      z-index: -1;
    }

    .attribution{position:fixed;left:10px;bottom:10px;font-size:11px;color:#a0c4ff;opacity:.8;background:rgba(0,0,0,.35);padding:6px 8px;border-radius:8px}
    
    .player{position:fixed;left:10px;right:10px;bottom:10px;display:flex;gap:8px;align-items:center;
             background:rgba(15,20,35,.35);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:8px;
             backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);color:#fff;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial;
             z-index: 20;}
    
    .player button{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:#fff;cursor:pointer}
    .player input[type=file]{display:none}
    
    .pill{position:fixed;top:10px;left:50%;transform:translateX(-50%);padding:6px 12px;border-radius:999px;
          background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.18);color:#fff;font:12px -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial; z-index: 10;}
    .error{position:fixed;inset:auto 10px 70px 10px;background:#001526;color:#d9f0ff;border:1px solid #8aceff;border-radius:10px;padding:10px;font:12px system-ui;display:none;}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>

<canvas id="galaxy-canvas"></canvas>
<div class="pill">Te Amo Muchote, Mis Ojitos Brillantes Blehüíô</div>
<div class="attribution">Base: tlanex ¬∑ Adaptaci√≥n para Jotab üí´</div>
<div id="err" class="error"></div>

<div class="player">
  <button id="playBtn">‚ñ∂Ô∏é</button>
  <span style="font-size:12px;opacity:.9"><b>blue.mp3</b> ¬∑ Detalles Mrüíôüåπ‚ô•Ô∏è</span>
  <input type="file" id="pickFile" accept="audio/*">
  <button id="pickBtn" style="margin-left:auto">Elegir canci√≥n</button>
  
  <audio id="audio" preload="none">
    <source src="blue.mp3" type="audio/mpeg">
  </audio>
</div>

<canvas id="fx" style="position:fixed;inset:0;pointer-events:none;"></canvas>

<script>
(function(){
const err = document.getElementById('err');
function showError(msg){ err.textContent = msg; err.style.display='block'; }

const audio = document.getElementById('audio');
const playBtn = document.getElementById('playBtn');
const pickBtn = document.getElementById('pickBtn');
const pickFile = document.getElementById('pickFile');

playBtn.onclick = async () => {
  try { 
    if (audio.paused) { 
      await audio.play(); 
      playBtn.textContent='‚è∏Ô∏é'; 
    } else { 
      audio.pause(); 
      playBtn.textContent='‚ñ∂Ô∏é'; 
    } 
  } catch(e){ showError('Selecciona tu MP3 para iniciar.'); }
};

pickBtn.onclick = () => pickFile.click();
pickFile.onchange = () => {
  if (pickFile.files && pickFile.files[0]) {
    const url = URL.createObjectURL(pickFile.files[0]);
    audio.src = url; 
    audio.play().then(()=> playBtn.textContent='‚è∏Ô∏é').catch(()=>{});
  }
};

try { 
  const canvas = document.getElementById('galaxy-canvas');
  const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, logarithmicDepthBuffer: true });
  renderer.setPixelRatio(Math.min(2, window.devicePixelRatio||1));
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.outputEncoding = THREE.sRGBEncoding;

  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;

  function setCam(){
    const isMobile = window.innerWidth < 768;
    camera.fov = isMobile ? 90 : 75;
    camera.position.set(0, isMobile? 26 : 22, isMobile? 110 : 75);
    camera.updateProjectionMatrix();
  } setCam(); window.addEventListener('resize', setCam);

  // Fondo y Galaxia
  const bg = new THREE.Mesh(new THREE.SphereGeometry(600, 32, 32), new THREE.MeshBasicMaterial({ color: 0x000510, side: THREE.BackSide }));
  scene.add(bg);

  const galaxy = new THREE.Group(); scene.add(galaxy);
  const phrases = ["Pinchecha ‚ú®", " Hermosa üíô", "Mi Bebe", "Mi Todo", "Te Amoüíô", "Mi Amor"];
  
  function makeTextTexture(text){
    const c=document.createElement('canvas'); c.width=512; c.height=64;
    const g=c.getContext('2d');
    g.font='bold 32px sans-serif'; g.textAlign='center'; g.fillStyle='white';
    g.fillText(text,256,40);
    return new THREE.CanvasTexture(c);
  }

  for(let i=0;i<100;i++){
    const spr=new THREE.Sprite(new THREE.SpriteMaterial({ map:makeTextTexture(phrases[i%phrases.length]), transparent:true, depthWrite:false }));
    const dist=Math.random()*70 + 15; const ang=Math.random()*Math.PI*2;
    spr.position.set(Math.cos(ang)*dist, (Math.random()-0.5)*10, Math.sin(ang)*dist);
    spr.scale.set(12,1.5,1); galaxy.add(spr);
  }

  // Agujero negro y ARO arreglado
  const core = new THREE.Mesh(new THREE.SphereGeometry(12, 32, 32), new THREE.MeshBasicMaterial({ color: 0x000000 }));
  scene.add(core);

  const photonRing = new THREE.Mesh(new THREE.RingGeometry(13, 14.5, 64), new THREE.MeshBasicMaterial({ color: 0xAECEFF, side: THREE.DoubleSide, transparent:true, opacity:0.8 }));
  photonRing.rotation.x = Math.PI/2;
  photonRing.position.y = 0.1; // Evita el parpadeo
  scene.add(photonRing);

  function animate(){
    requestAnimationFrame(animate);
    galaxy.rotation.y += 0.001;
    photonRing.rotation.z += 0.005;
    controls.update();
    renderer.render(scene, camera);
  } animate();

} catch(e) { console.error(e); }
})();
</script>
</body>
</html>
